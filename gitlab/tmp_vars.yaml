---
#Level CI
#Debug
#------------------------------------------------------------------------------------------------------------------#
debug:
  mode: true
#------------------------------------------------------------------------------------------------------------------#

#Variables ==> {={ xxx }=}
#------------------------------------------------------------------------------------------------------------------#
vars:
  token: "y0_AgAAAABkbnEbAATuwQAAAADRe319HyCOnGH2Q2SiGV_TEQrlLBgz1RI"      
  cloud_id: "b1gbalrr4suqf4hapk6f"
  folder_id: "b1gq0mj5rh4up9offieh"
  zone: "ru-central1-a"
  subnet_id: "e9b8fq1qlnj7mb6r5rgf"
  hostname: "gitlab"
  user: "admin"
  ansible_python_interpreter: "/usr/bin/python3"
  ssh_key_path: "/root/.ssh/id_rsa.pub"
  image_id: "fd8m8s42796gm6v7sf8e" #Debian 11
  vm_memory: "6"
  vm_Vcpu: "2"
  vm_disk_size: "15"
  path_tmp: tmp/ #Папка tmp
#------------------------------------------------------------------------------------------------------------------#



#Rendering file
#------------------------------------------------------------------------------------------------------------------#
# render:  
#   file:
#     - "tmp/main.tf"
#     - "tmp/main.yaml"
#------------------------------------------------------------------------------------------------------------------#



#=====================
#Assembly levels
#=====================

level5.4:
  print: Checkout branch
  git:
    checkout: dev

#File preparation
#------------------------------------------------------------------------------------------------------------------#
level1:
  print: PWD
  pwd:
  #cd: gitlab/


level1.1:
  print: Checkout branch
  git:
    checkout: tmp_dev
    status:
    #remote:

level1.2:
  print: Add file meta.yaml
  prog: bash
  code: |
    cat < EOF > meta.yaml
    #cloud-config
    ssh_pwauth: no
    users:
      - name: admin
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/bash
        ssh_authorized_keys:
          - /root/.ssh/id_rsa.pub
    EOF
#------------------------------------------------------------------------------------------------------------------#


level4:
  print: test1



#Terraform OS creation
#------------------------------------------------------------------------------------------------------------------#
level2:
  print: Terraform OS creation

level2.1: 
  print: Terraform OS install
  prog: bash
  code: | 
    cd templates/terraform/main.tf && terraform init
    cd templates/ansible/main.yaml && terraform apply -no-color -input=false -auto-approve=true

# level2.2: 
#   print: Terraform OS destroy
#   prog: bash
#   code: | 
#     terraform destroy -no-color -input=false -auto-approve=true
#     rm папка темп
#------------------------------------------------------------------------------------------------------------------#
  

#Anseble install gitlab
#------------------------------------------------------------------------------------------------------------------#
level3:
  print: Install gitlab 
  prog: bash
  code: |
    cd templates/ansible/gitlab.yaml && ansible-playbook
#------------------------------------------------------------------------------------------------------------------# 
...